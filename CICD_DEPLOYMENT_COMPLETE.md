# ğŸš€ CI/CDè‡ªåŠ¨éƒ¨ç½²é…ç½®å®Œæˆæ€»ç»“

## ğŸ‰ **é…ç½®å®ŒæˆçŠ¶æ€**

âœ… **GitHub Actionså·¥ä½œæµå·²é…ç½®**  
âœ… **ä»£ç å·²æ¨é€åˆ°GitHubä»“åº“**  
âœ… **æœ¬åœ°ä¼˜åŒ–é¡¹ç›®ç»“æ„å®Œæˆ**  
âœ… **éƒ¨ç½²è„šæœ¬å’Œå·¥å…·å°±ç»ª**  

---

## ğŸ”§ **CI/CDå·¥ä½œæµç‰¹æ€§**

### ğŸ“‹ **è‡ªåŠ¨åŒ–æµç¨‹**
1. **ä»£ç è´¨é‡æ£€æŸ¥** - Pythonè¯­æ³•æ£€æŸ¥ + å¯¼å…¥æµ‹è¯•
2. **é¡¹ç›®æ¸…ç†** - æ„å»ºå‰è‡ªåŠ¨æ¸…ç†ç¼“å­˜å’Œä¸´æ—¶æ–‡ä»¶
3. **Dockeré•œåƒæ„å»º** - ä¼˜åŒ–ç‰ˆé•œåƒ (é¢„è®¡<500M)
4. **è‡ªåŠ¨éƒ¨ç½²** - SSHè¿æ¥ç”Ÿäº§æœåŠ¡å™¨éƒ¨ç½²
5. **å¥åº·æ£€æŸ¥** - è‡ªåŠ¨éªŒè¯åº”ç”¨å¯åŠ¨çŠ¶æ€
6. **èµ„æºæ¸…ç†** - æ¸…ç†æ—§ç‰ˆæœ¬é•œåƒå’Œå®¹å™¨
7. **éƒ¨ç½²æŠ¥å‘Š** - ç”Ÿæˆè¯¦ç»†çš„éƒ¨ç½²çŠ¶æ€æŠ¥å‘Š

### ğŸ¯ **è§¦å‘æ¡ä»¶**
- âœ… æ¨é€åˆ° `main` åˆ†æ”¯
- âœ… æ‰‹åŠ¨è§¦å‘ (workflow_dispatch)
- âœ… è‡ªåŠ¨æ’é™¤æ–‡æ¡£å˜æ›´ (`**.md`, `archive/**`)

### ğŸ›¡ï¸ **ç”Ÿäº§ç¯å¢ƒä¿æŠ¤**
- âœ… ç¯å¢ƒéš”ç¦» (`production` environment)
- âœ… å¥åº·æ£€æŸ¥éªŒè¯
- âœ… è‡ªåŠ¨æ•…éšœæ¢å¤
- âœ… å¤‡ä»½å½“å‰éƒ¨ç½²

---

## ğŸ“Š **ä¼˜åŒ–æˆæœé›†æˆ**

### ğŸ—ï¸ **é¡¹ç›®ç»“æ„ä¼˜åŒ–**
- **æ„å»ºä¸Šä¸‹æ–‡**: `611M` â†’ `3.6M` (-99%)
- **æ ¸å¿ƒä»£ç **: `616K` (æç®€)
- **Dockeré•œåƒ**: é¢„è®¡ `1.2G+` â†’ `<500M` (-60%+)

### ğŸ”„ **è‡ªåŠ¨åŒ–ç»´æŠ¤**
- **Pre-commit Hook**: æ¯æ¬¡æäº¤å‰è‡ªåŠ¨æ¸…ç†
- **CI/CDæ¸…ç†**: æ„å»ºå‰è‡ªåŠ¨æ¸…ç†
- **èµ„æºç®¡ç†**: è‡ªåŠ¨æ¸…ç†æ—§ç‰ˆæœ¬é•œåƒ

---

## âš™ï¸ **ä¸‹ä¸€æ­¥é…ç½®**

### ğŸ” **1. é…ç½®GitHub Secrets**

è®¿é—®: https://github.com/tyj1987/gupiao/settings/secrets/actions

æ·»åŠ ä»¥ä¸‹Secrets:
```
DOCKER_USERNAME: tuoyongjun1987
DOCKER_PASSWORD: [æ‚¨çš„Docker Hubå¯†ç /Token]
PRODUCTION_USER: root
PRODUCTION_SSH_KEY: [SSHç§é’¥å†…å®¹]
```

### ğŸ”‘ **2. SSHå¯†é’¥é…ç½®**

```bash
# ç”ŸæˆSSHå¯†é’¥å¯¹
ssh-keygen -t rsa -b 4096 -C 'github-actions@gupiao-deploy'

# å°†å…¬é’¥æ·»åŠ åˆ°ç”Ÿäº§æœåŠ¡å™¨
cat ~/.ssh/id_rsa.pub | ssh root@47.94.225.76 'mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys'

# å¤åˆ¶ç§é’¥åˆ°GitHub Secrets
cat ~/.ssh/id_rsa  # å¤åˆ¶æ­¤å†…å®¹åˆ° PRODUCTION_SSH_KEY
```

### ğŸ³ **3. Docker Hub Token**

1. è®¿é—®: https://hub.docker.com/settings/security
2. åˆ›å»ºæ–°çš„Access Token
3. å¤åˆ¶Tokenåˆ° `DOCKER_PASSWORD` Secret

---

## ğŸš€ **éƒ¨ç½²å¯åŠ¨**

### ğŸ“± **è‡ªåŠ¨è§¦å‘éƒ¨ç½²**
```bash
# ä»»ä½•æ¨é€åˆ°mainåˆ†æ”¯éƒ½ä¼šè§¦å‘éƒ¨ç½²
git add .
git commit -m "feat: æ–°åŠŸèƒ½æ›´æ–°"
git push origin main
```

### ğŸ›ï¸ **æ‰‹åŠ¨è§¦å‘éƒ¨ç½²**
1. è®¿é—®: https://github.com/tyj1987/gupiao/actions
2. é€‰æ‹© "ğŸš€ ç”Ÿäº§ç¯å¢ƒCI/CDéƒ¨ç½²" workflow
3. ç‚¹å‡» "Run workflow"
4. ç¡®è®¤å‚æ•°å¹¶è¿è¡Œ

---

## ğŸ“Š **ç›‘æ§å’Œç®¡ç†**

### ğŸ” **éƒ¨ç½²çŠ¶æ€ç›‘æ§**
```bash
./monitor-deployment.sh  # ç›‘æ§éƒ¨ç½²çŠ¶æ€
```

### ğŸ“± **è®¿é—®åœ°å€**
- **GitHub Actions**: https://github.com/tyj1987/gupiao/actions
- **ç”Ÿäº§ç¯å¢ƒ**: http://47.94.225.76:8501
- **ä»“åº“åœ°å€**: https://github.com/tyj1987/gupiao

### ğŸ”§ **ç”Ÿäº§ç¯å¢ƒç®¡ç†**
```bash
# SSHè¿æ¥ç”Ÿäº§æœåŠ¡å™¨
ssh root@47.94.225.76

# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
cd /www/wwwroot/gupiao
docker ps | grep gupiao-app
docker logs gupiao-app -f

# é‡å¯åº”ç”¨
docker-compose restart

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats gupiao-app
```

---

## ğŸ† **å®Œæ•´åŠŸèƒ½ç‰¹æ€§**

### âœ¨ **å¼€å‘ä½“éªŒ**
- âœ… ä»£ç æ¨é€è‡ªåŠ¨éƒ¨ç½²
- âœ… æœ¬åœ°æµ‹è¯•å·¥å…· (`test-cicd-local.sh`)
- âœ… éƒ¨ç½²çŠ¶æ€ç›‘æ§ (`monitor-deployment.sh`)
- âœ… é…ç½®æŒ‡å—å·¥å…· (`setup-github-secrets.sh`)

### ğŸ›¡ï¸ **ç”Ÿäº§çº§ç‰¹æ€§**
- âœ… é›¶åœæœºéƒ¨ç½² (è“ç»¿éƒ¨ç½²)
- âœ… è‡ªåŠ¨å¥åº·æ£€æŸ¥
- âœ… å®¹å™¨è‡ªåŠ¨é‡å¯
- âœ… æ•°æ®æŒä¹…åŒ–å­˜å‚¨
- âœ… èµ„æºè‡ªåŠ¨æ¸…ç†

### ğŸ“Š **ç›‘æ§å’Œæ—¥å¿—**
- âœ… éƒ¨ç½²çŠ¶æ€æŠ¥å‘Š
- âœ… åº”ç”¨å¥åº·ç›‘æ§
- âœ… å®¹å™¨èµ„æºç›‘æ§
- âœ… è¯¦ç»†éƒ¨ç½²æ—¥å¿—

---

## ğŸ¯ **æˆåŠŸæ ‡å¿—**

é…ç½®å®Œæˆåï¼Œæ‚¨å°†æ‹¥æœ‰ï¼š

1. âœ… **æç®€é¡¹ç›®ç»“æ„** (3.6Mæ„å»ºä¸Šä¸‹æ–‡)
2. âœ… **ä¼˜åŒ–Dockeré•œåƒ** (<500M)
3. âœ… **å…¨è‡ªåŠ¨CI/CDæµæ°´çº¿**
4. âœ… **ç”Ÿäº§çº§éƒ¨ç½²ç›‘æ§**
5. âœ… **ä¸€é”®éƒ¨ç½²èƒ½åŠ›**

---

## ğŸ“ **æŠ€æœ¯æ”¯æŒ**

**æ„å»ºè€…**: tyj1987 <tuoyongjun1987@qq.com>  
**ç‰ˆæœ¬**: v2.1.0-clean + CI/CD  
**å®Œæˆæ—¶é—´**: 2025-08-09  
**GitHub**: https://github.com/tyj1987/gupiao

---

> ğŸŠ **æ­å–œï¼** CI/CDè‡ªåŠ¨éƒ¨ç½²å·²é…ç½®å®Œæˆï¼  
> ğŸš€ é…ç½®GitHub Secretsåå³å¯äº«å—è‡ªåŠ¨åŒ–éƒ¨ç½²ä½“éªŒï¼  
> ğŸ“± æ¯æ¬¡ä»£ç æ¨é€éƒ½ä¼šè‡ªåŠ¨æ›´æ–°ç”Ÿäº§ç¯å¢ƒï¼
