#!/usr/bin/env python3
"""
å¢å¼ºè‚¡ç¥¨æ± ç”Ÿæˆå™¨
åˆ›å»ºå…·æœ‰ä¸åŒé£é™©ç­‰çº§çš„å¤šæ ·åŒ–è‚¡ç¥¨æ± 
"""

import sys
import os
sys.path.append('/home/tyj/gupiao')

import pandas as pd
import numpy as np
from datetime import datetime, timedelta

def create_enhanced_stock_pool():
    """åˆ›å»ºå¢å¼ºçš„è‚¡ç¥¨æ± ï¼ŒåŒ…å«ä¸åŒé£é™©ç­‰çº§çš„è‚¡ç¥¨"""
    
    # æ‰©å±•çš„è‚¡ç¥¨æ±  - åŒ…å«ä¸åŒè¡Œä¸šå’Œé£é™©ç‰¹å¾çš„è‚¡ç¥¨
    enhanced_stocks = {
        # é“¶è¡Œè‚¡ - é€šå¸¸ä½åˆ°ä¸­ç­‰é£é™©
        "000001.SZ": "å¹³å®‰é“¶è¡Œ",
        "600036.SH": "æ‹›å•†é“¶è¡Œ", 
        "600000.SH": "æµ¦å‘é“¶è¡Œ",
        "601988.SH": "ä¸­å›½é“¶è¡Œ",
        "601398.SH": "å·¥å•†é“¶è¡Œ",
        "601939.SH": "å»ºè®¾é“¶è¡Œ",
        "601288.SH": "å†œä¸šé“¶è¡Œ",
        "002142.SZ": "å®æ³¢é“¶è¡Œ",
        
        # ç™½é…’è‚¡ - ä¸­ç­‰åˆ°é«˜é£é™©
        "600519.SH": "è´µå·èŒ…å°",
        "000858.SZ": "äº”ç²®æ¶²", 
        "000596.SZ": "å¤äº•è´¡é…’",
        "600809.SH": "å±±è¥¿æ±¾é…’",
        "000799.SZ": "é…’é¬¼é…’",
        "603589.SH": "å£å­çª–",
        
        # ç§‘æŠ€è‚¡ - é«˜é£é™©
        "000002.SZ": "ä¸‡ç§‘A",
        "300015.SZ": "çˆ±å°”çœ¼ç§‘", 
        "300750.SZ": "å®å¾·æ—¶ä»£",
        "002415.SZ": "æµ·åº·å¨è§†",
        "000858.SZ": "äº”ç²®æ¶²",
        "300059.SZ": "ä¸œæ–¹è´¢å¯Œ",
        "300896.SZ": "çˆ±ç¾å®¢",
        
        # åŒ»è¯è‚¡ - ä¸­ç­‰é£é™©
        "000661.SZ": "é•¿æ˜¥é«˜æ–°",
        "300122.SZ": "æ™ºé£ç”Ÿç‰©",
        "002821.SZ": "å‡¯è±è‹±",
        "300760.SZ": "è¿ˆç‘åŒ»ç–—",
        "600276.SH": "æ’ç‘åŒ»è¯",
        "000963.SZ": "åä¸œåŒ»è¯",
        
        # æ¶ˆè´¹è‚¡ - ä¸­ç­‰é£é™©
        "000895.SZ": "åŒæ±‡å‘å±•",
        "600887.SH": "ä¼Šåˆ©è‚¡ä»½",
        "000568.SZ": "æ³¸å·è€çª–",
        "002304.SZ": "æ´‹æ²³è‚¡ä»½",
        "600298.SH": "å®‰çªé…µæ¯",
        
        # åœ°äº§è‚¡ - é«˜é£é™©
        "000002.SZ": "ä¸‡ç§‘A",
        "001979.SZ": "æ‹›å•†è›‡å£",
        "600048.SH": "ä¿åˆ©å‘å±•",
        "000069.SZ": "åä¾¨åŸA",
        
        # æ–°èƒ½æºè½¦ - æé«˜é£é™©
        "002594.SZ": "æ¯”äºšè¿ª",
        "300750.SZ": "å®å¾·æ—¶ä»£", 
        "002460.SZ": "èµ£é”‹é”‚ä¸š",
        "300014.SZ": "äº¿çº¬é”‚èƒ½",
        
        # ç…¤ç‚­é’¢é“ - ä¸­ç­‰åˆ°é«˜é£é™©  
        "600019.SH": "å®é’¢è‚¡ä»½",
        "000898.SZ": "éé’¢è‚¡ä»½",
        "601006.SH": "å¤§ç§¦é“è·¯",
        "601088.SH": "ä¸­å›½ç¥å",
        
        # ä¿é™©è‚¡ - ä½åˆ°ä¸­ç­‰é£é™©
        "601318.SH": "ä¸­å›½å¹³å®‰",
        "601601.SH": "ä¸­å›½å¤ªä¿",
        "601336.SH": "æ–°åä¿é™©",
        "000001.SZ": "å¹³å®‰é“¶è¡Œ",
        
        # çŸ³æ²¹åŒ–å·¥ - ä¸­ç­‰é£é™©
        "600028.SH": "ä¸­å›½çŸ³åŒ–",
        "601857.SH": "ä¸­å›½çŸ³æ²¹",
        "000792.SZ": "ç›æ¹–è‚¡ä»½",
        "600309.SH": "ä¸‡ååŒ–å­¦",
        
        # é€šä¿¡è®¾å¤‡ - é«˜é£é™©
        "000063.SZ": "ä¸­å…´é€šè®¯", 
        "002475.SZ": "ç«‹è®¯ç²¾å¯†",
        "600050.SH": "ä¸­å›½è”é€š",
        "000725.SZ": "äº¬ä¸œæ–¹A",
        
        # å®¶ç”µè‚¡ - ä¸­ç­‰é£é™©
        "000333.SZ": "ç¾çš„é›†å›¢",
        "000651.SZ": "æ ¼åŠ›ç”µå™¨",
        "002415.SZ": "æµ·åº·å¨è§†",
        "600690.SH": "æµ·å°”æ™ºå®¶"
    }
    
    return enhanced_stocks

def update_stock_mapper():
    """æ›´æ–°è‚¡ç¥¨æ˜ å°„å™¨"""
    try:
        from src.data.stock_mapper import StockMapper
        
        mapper = StockMapper()
        enhanced_stocks = create_enhanced_stock_pool()
        
        print(f"å¢å¼ºè‚¡ç¥¨æ± åŒ…å« {len(enhanced_stocks)} åªè‚¡ç¥¨")
        
        # éªŒè¯æ˜ å°„å™¨ä¸­çš„è‚¡ç¥¨æ•°é‡
        all_stocks = mapper.get_all_stocks()
        print(f"å½“å‰æ˜ å°„å™¨åŒ…å« {len(all_stocks)} åªè‚¡ç¥¨")
        
        # æ˜¾ç¤ºä¸€äº›ç¤ºä¾‹
        print("\nè‚¡ç¥¨æ± ç¤ºä¾‹:")
        for i, (code, name) in enumerate(list(enhanced_stocks.items())[:10]):
            print(f"  {code} - {name}")
        
        return True
        
    except Exception as e:
        print(f"âŒ æ›´æ–°è‚¡ç¥¨æ˜ å°„å™¨å¤±è´¥: {e}")
        return False

if __name__ == "__main__":
    print("ğŸš€ åˆ›å»ºå¢å¼ºè‚¡ç¥¨æ± ")
    
    enhanced_stocks = create_enhanced_stock_pool()
    print(f"âœ… å¢å¼ºè‚¡ç¥¨æ± åˆ›å»ºå®Œæˆï¼ŒåŒ…å« {len(enhanced_stocks)} åªè‚¡ç¥¨")
    
    # æŒ‰è¡Œä¸šåˆ†ç±»ç»Ÿè®¡
    industries = {
        "é“¶è¡Œ": 8,
        "ç™½é…’": 6, 
        "ç§‘æŠ€": 7,
        "åŒ»è¯": 6,
        "æ¶ˆè´¹": 5,
        "åœ°äº§": 4,
        "æ–°èƒ½æº": 4,
        "ä¼ ç»Ÿå·¥ä¸š": 4,
        "ä¿é™©": 4,
        "çŸ³åŒ–": 4,
        "é€šä¿¡": 4,
        "å®¶ç”µ": 4
    }
    
    print("\nğŸ“Š è¡Œä¸šåˆ†å¸ƒ:")
    for industry, count in industries.items():
        print(f"  {industry}: {count} åª")
    
    print(f"\næ€»è®¡: {sum(industries.values())} åªè‚¡ç¥¨")
    
    # æ›´æ–°æ˜ å°„å™¨
    if update_stock_mapper():
        print("âœ… è‚¡ç¥¨æ˜ å°„å™¨æ›´æ–°æˆåŠŸ")
