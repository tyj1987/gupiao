#!/usr/bin/env python3
"""
åˆ›å»ºå¤šæ ·åŒ–é£é™©è‚¡ç¥¨æ± æµ‹è¯•
"""

import sys
import os
sys.path.append('/home/tyj/gupiao')

def test_diverse_stock_pool():
    """æµ‹è¯•å¤šæ ·åŒ–çš„è‚¡ç¥¨æ± """
    
    # ä¸åŒé£é™©ç‰¹å¾çš„è‚¡ç¥¨æ± 
    test_stocks = {
        # ä½é£é™©å€™é€‰ï¼šå¤§å‹é“¶è¡Œã€å…¬ç”¨äº‹ä¸šã€ç¨³å®šæ¶ˆè´¹
        "600036.SH": "æ‹›å•†é“¶è¡Œ",    # ä¼˜è´¨é“¶è¡Œ
        "601318.SH": "ä¸­å›½å¹³å®‰",    # ä¿é™©é¾™å¤´
        "000858.SZ": "äº”ç²®æ¶²",      # ç¨³å®šæ¶ˆè´¹
        "600519.SH": "è´µå·èŒ…å°",    # æ¶ˆè´¹ç™½é©¬
        
        # ä¸­ç­‰é£é™©å€™é€‰ï¼šåˆ¶é€ ä¸šã€åŒ»è¯ã€ç§‘æŠ€è“ç­¹
        "000002.SZ": "ä¸‡ç§‘A",       # åœ°äº§é¾™å¤´
        "002415.SZ": "æµ·åº·å¨è§†",    # ç§‘æŠ€åˆ¶é€ 
        "600276.SH": "æ’ç‘åŒ»è¯",    # åŒ»è¯é¾™å¤´
        "000661.SZ": "é•¿æ˜¥é«˜æ–°",    # åŒ»è¯æˆé•¿
        
        # é«˜é£é™©å€™é€‰ï¼šæ–°å…´ç§‘æŠ€ã€å°ç›˜æˆé•¿ã€å‘¨æœŸæ€§è¡Œä¸š
        "300750.SZ": "å®å¾·æ—¶ä»£",    # æ–°èƒ½æº
        "002594.SZ": "æ¯”äºšè¿ª",      # æ–°èƒ½æºè½¦
        "300015.SZ": "çˆ±å°”çœ¼ç§‘",    # åŒ»ç–—æœåŠ¡
        "300059.SZ": "ä¸œæ–¹è´¢å¯Œ",    # é‡‘èç§‘æŠ€
        
        # æ½œåœ¨ä½é£é™©ï¼šå…¬ç”¨äº‹ä¸šã€åŸºç¡€è®¾æ–½
        "601006.SH": "å¤§ç§¦é“è·¯",    # é“è·¯è¿è¾“
        "600028.SH": "ä¸­å›½çŸ³åŒ–",    # èƒ½æºå¤®ä¼
        "000895.SZ": "åŒæ±‡å‘å±•",    # é£Ÿå“ç¨³å®š
        "600887.SH": "ä¼Šåˆ©è‚¡ä»½",    # ä¹³ä¸šé¾™å¤´
    }
    
    print(f"æµ‹è¯•è‚¡ç¥¨æ± åŒ…å« {len(test_stocks)} åªè‚¡ç¥¨")
    print("\næŒ‰é¢„æœŸé£é™©åˆ†ç±»:")
    print("ğŸŸ¢ ä½é£é™©å€™é€‰: æ‹›å•†é“¶è¡Œ, ä¸­å›½å¹³å®‰, äº”ç²®æ¶², è´µå·èŒ…å°")
    print("ğŸŸ¡ ä¸­ç­‰é£é™©å€™é€‰: ä¸‡ç§‘A, æµ·åº·å¨è§†, æ’ç‘åŒ»è¯, é•¿æ˜¥é«˜æ–°")  
    print("ğŸ”´ é«˜é£é™©å€™é€‰: å®å¾·æ—¶ä»£, æ¯”äºšè¿ª, çˆ±å°”çœ¼ç§‘, ä¸œæ–¹è´¢å¯Œ")
    print("ğŸŸ¢ ç¨³å®šå‹å€™é€‰: å¤§ç§¦é“è·¯, ä¸­å›½çŸ³åŒ–, åŒæ±‡å‘å±•, ä¼Šåˆ©è‚¡ä»½")
    
    return test_stocks

def test_risk_assessment_on_diverse_pool():
    """åœ¨å¤šæ ·åŒ–è‚¡ç¥¨æ± ä¸Šæµ‹è¯•é£é™©è¯„ä¼°"""
    
    try:
        from src.ai.stock_analyzer import StockAnalyzer
        
        analyzer = StockAnalyzer()
        test_stocks = list(test_diverse_stock_pool().keys())
        
        print(f"\nğŸ” æµ‹è¯•å¤šæ ·åŒ–è‚¡ç¥¨æ± çš„é£é™©åˆ†å¸ƒ")
        print("=" * 60)
        
        # æµ‹è¯•ä¸åŒé£é™©çº§åˆ«çš„ç­›é€‰æ•ˆæœ
        risk_levels = ["ä½é£é™©", "ä¸­ç­‰é£é™©", "é«˜é£é™©"]
        
        for risk_level in risk_levels:
            print(f"\n--- é£é™©çº§åˆ«: {risk_level} ---")
            
            results = analyzer.screen_stocks(
                stock_list=test_stocks[:8],  # æµ‹è¯•å‰8åªè‚¡ç¥¨
                min_score=0,
                risk_level=risk_level,
                market_cap="ä¸é™"
            )
            
            print(f"ç­›é€‰ç»“æœ: {len(results)} åªè‚¡ç¥¨")
            
            if results:
                for result in results:
                    print(f"  ğŸ“Š {result['symbol']} - {result['name']}: "
                          f"è¯„åˆ†={result['score']}, é£é™©={result['risk_level']}")
            else:
                print("  ğŸ” æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨")
        
        return True
        
    except Exception as e:
        print(f"âŒ æµ‹è¯•å¤±è´¥: {e}")
        return False

if __name__ == "__main__":
    print("ğŸ§ª å¤šæ ·åŒ–é£é™©è‚¡ç¥¨æ± æµ‹è¯•")
    print("=" * 50)
    
    # æ˜¾ç¤ºæµ‹è¯•è‚¡ç¥¨æ± 
    test_stocks = test_diverse_stock_pool()
    
    # è¿è¡Œé£é™©è¯„ä¼°æµ‹è¯•
    print("\n" + "=" * 50)
    success = test_risk_assessment_on_diverse_pool()
    
    if success:
        print("\nâœ… æµ‹è¯•å®Œæˆï¼ç³»ç»Ÿèƒ½å¤ŸåŒºåˆ†ä¸åŒé£é™©çº§åˆ«çš„è‚¡ç¥¨")
    else:
        print("\nâŒ æµ‹è¯•å¤±è´¥ï¼Œéœ€è¦è¿›ä¸€æ­¥è°ƒè¯•")
